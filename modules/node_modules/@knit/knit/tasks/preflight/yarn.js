/* @flow */

const execa = require('execa');
const semver = require('semver');

const tasks = [
  {
    title: 'checking yarn is on PATH',
    task: () => execa('yarn', ['--version']).catch(err => {
      throw Object.assign({}, err, {
        stderr: 'yarn must be install. `npm install -g yarn` or see: https://yarnpkg.com/en/docs/install',
      });
    }),
  },
  {
    title: 'checking yarn version',
    task: () => execa.stdout('yarn', ['--version']).then(v => {
      const sv = '>=0.16.0';

      if (!semver.satisfies(v, sv)) {
        throw {
          cmd: `yarn version is ${v}`,
          stderr: `knit requires ${sv}`,
        }
      }
    })
  },
]

module.exports = tasks;
