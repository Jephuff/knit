/* @flow weak */

const execa = require('execa');
const semver = require('semver');

const needle = require('@knit/needle');

const tasks = [
  {
    title: 'validate version',
    task: ctx => {
      if (!semver.valid(ctx.version)) {
        throw {
          cmd: 'version failed validation',
          stderr: `\`${ctx.version}\` must be a valid semver version.`,
        }
      }

      if (semver.gte(needle.pkg.version, ctx.version)) {
        throw {
          cmd: 'version failed validation',
          stdout: `\`${ctx.version}\` should be higher than current version \`${ctx.version}\``,
        }
      }
    },
  },
]

module.exports = tasks;
