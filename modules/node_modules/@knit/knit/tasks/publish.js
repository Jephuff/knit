/* @flow weak */

const execa = require('execa');
const path = require('path');
const Listr = require('listr');

const needle = require('@knit/needle');

const knit = require('..');

const createPublishTask = (m) => ({
  title: m,
  task: ctx => (
     execa('npm', [
       'publish',
     ], {
       cwd: path.join(needle.paths.modules, m),
     })
  ),
});

const tasks = [
  {
    title: 'publishing updated modules',
    task: ctx => new Listr(ctx.updated.map(createPublishTask), { concurrent: false }),
  },
];

module.exports = tasks;
