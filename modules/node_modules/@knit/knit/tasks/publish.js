/* @flow weak */

const execa = require('execa');
const path = require('path');
const Listr = require('listr');

const needle = require('@knit/needle');

const knit = require('@knit/knit');

const createPublishTask = (m) => ({
  title: m,
  task: ctx => {
    const moduleDir = path.join(needle.paths.modules, m);
    return execa('yarn', [
      'publish', moduleDir,
    ], {
      cwd: moduleDir,
    });
  },
});

const tasks = [
  {
    title: 'publishing updated modules',
    task: ctx => new Listr(ctx.updated.map(createPublishTask), { concurrent: false }),
  },
];

module.exports = tasks;
