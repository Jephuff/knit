#!/usr/bin/env node

const Listr = require('listr');

const errors = require('../lib/errors');
const log = require('../lib/log');

module.exports = (opts) => {
  new Listr([
    ...require('../tasks/preflight/istag'),
    ...require('../tasks/preflight/git'),
    ...require('../tasks/preflight/yarn'),
    ...require('../tasks/modules'),
    ...require('../tasks/preflight/knit'),
    ...require('../tasks/packages'),
    ...require('../tasks/updated'),
    ...require('../tasks/build'),
    ...require('../tasks/knit'),
    ...require('../tasks/publish'),
    ...require('../tasks/reset'),
  ], {
    renderer: log.getRenderer(),
  }).run({ forceAll: opts.forceAll }).catch(errors.catchErrors);
};
