#!/usr/bin/env node

const Listr = require('listr');

const errors = require('@knit/mittens-nice-errors');
const log = require('@knit/mittens-logger');
const tasks = require('@knit/mittens-common-tasks');

module.exports = (argv) => {
  new Listr([
    ...tasks.preflight.version,
    ...tasks.preflight.git,
    ...tasks.preflight.yarn,
    ...tasks.modules,
    ...tasks.preflight.knit,
    ...tasks.packages,
    ...tasks.updated,
    ...require('../tasks/version'),
    ...require('../tasks/build'),
    ...require('../tasks/knit'),
    ...require('../tasks/publish'),
    ...require('../tasks/reset'),
  ], {
    renderer: log.getRenderer(),
    collapse: false,
  }).run({
    version: argv.version,
    forceAll: argv.forceAll,
  }).catch(errors.catchErrors);
};
