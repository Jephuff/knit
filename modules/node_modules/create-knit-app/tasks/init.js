/* @flow weak */

const path = require('path');
const fs = require('fs-extra');
const execa = require('execa');
const Listr = require('listr');
const pify = require('pify');

const tasks = [
  {
    title: 'copying template files',
    task: ctx => pify(fs.copy)(path.resolve(path.join(__dirname, '..', 'template')), ctx.cwd),
  },
  {
    title: 'initializing',
    task: ctx => execa('yarn', ['init', '--yes'], { cwd: ctx.cwd }).then(() => (
      execa('git', ['init'], { cwd: ctx.cwd })
    )),
  },
  {
    title: 'installing packages',
    task: ctx => execa(
      'yarn', ['add', 'react', 'glamor'], { cwd: ctx.cwd }
    ).then(() =>
      execa('yarn', ['add', '--dev', 'react-dom'], { cwd: ctx.cwd })
    ),
  },
  {
    title: 'installing knit',
    task: ctx => execa(
      'yarn', [
        'add', '--dev',
        '@knit/knit', '@knit/eslint-config-socks',
        '@knit/mittens-develop', '@knit/mittens-publish',
      ], { cwd: ctx.cwd }
    ),
  },
];

module.exports = tasks;
